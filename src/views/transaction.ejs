<div class="container-fluid">
   <div class="row">
      <div class="col-lg-12">
         <h1 class="page-header">New transaction</h1>
      </div>
      <!-- /.col-lg-12 -->
   </div>
   <!-- /.row -->
   <div class="row">
      <div class="col-lg-12">
         <div class="panel panel-default">
            <div class="panel-heading">
               New transaction
            </div>
            <div class="panel-body">
               <div class="row">
                  <form id="newTransactionForm">
                     <div class="modal-body" id="dialogLogBody"
                        style="font-size: smaller; width: 100%; word-wrap: break-word; display: inline-block; text-align:justify;">
                        <fieldset class="fieldset-new">

                           <div class="row">
                              <div class="form-group col-12 col-lg-3">
                                 <label for="confirmType">Type</label>
                                 <div class="input-group">
                                    <select class="form-control" id="confirmType">
                                       <option value="INCOME">INCOME</option>
                                       <option value="EXPENSE">EXPENSE</option>
                                    </select>
                                 </div>
                              </div>

                              <div class="form-group col-12 col-lg-3">
                                 <label for="confirmCategory">Category</label>
                                 <div class="input-group">
                                    <select class="form-control" id="confirmCategory">
                                       <option value="HOME">HOME</option>
                                       <option value="INVESTMENTS">INVESTMENTS</option>
                                       <option value="DONATION">DONATION</option>
                                       <option value="SERVICES">SERVICES</option>
                                       <option value="OTHERS">OTHERS</option>
                                    </select>
                                 </div>
                              </div>

                              <div class="form-group col-12 col-lg-3">
                                 <label for="confirmDate">Date</label>
                                 <div class="input-group">
                                    <input class="form-control" type="date" name="confirmDate" id="confirmDate" />
                                    <div class="invalid-tooltip" id="msgConfirmDate"></div>
                                 </div>
                              </div>

                              <div class="form-group col-12 col-lg-3">
                                 <label for="confirmAmount">Amount</label>
                                 <div class="input-group">
                                    <input class="form-control" type="number" name="confirmAmount" id="confirmAmount"
                                       step="0.01" />
                                    <div class="invalid-tooltip" id="msgConfirmAmount"></div>
                                 </div>
                              </div>
                           </div>

                           <div class="row">
                              <div class="form-group col-12 col-lg-3">
                                 <label for="confirmMethod">Method</label>
                                 <div class="input-group">
                                    <select class="form-control" id="confirmMethod">
                                       <option value="NUBANK">NUBANK</option>
                                       <option value="ITAU">ITAU</option>
                                       <option value="MERCADO PAGO">MERCADO PAGO</option>
                                       <option value="PIC PAY">PIC PAY</option>
                                       <option value="CASH">CASH</option>
                                    </select>
                                 </div>
                              </div>

                              <div class="form-group col-12 col-lg-3">
                                 <label for="confirmStatus">Status</label>
                                 <div class="input-group">
                                    <select class="form-control" id="confirmStatus">
                                       <option value="PENDING">PENDING</option>
                                       <option value="DONE">DONE</option>
                                    </select>
                                 </div>
                              </div>

                              <div class="form-group col-12 col-lg-3">
                                 <label for="confirmDescription">Description</label>
                                 <div class="input-group">
                                    <input class="form-control" type="text" name="confirmDescription"
                                       id="confirmDescription" />
                                    <div class="invalid-tooltip" id="msgConfirmDescription"></div>
                                 </div>
                              </div>

                              <div class="form-group col-12 col-lg-3">
                                 <label for="confirmNumberOfInstallments">Number Of Installments</label>
                                 <div class="input-group">
                                    <input class="form-control" type="number" name="confirmNumberOfInstallments"
                                       id="confirmNumberOfInstallments" step="1" />
                                    <div class="invalid-tooltip" id="msgConfirmNumberOfInstallments"></div>
                                 </div>
                              </div>
                           </div>

                           <div class="row">

                              <div class="form-group col-12 col-lg-3">
                                 <label for="confirmInstallmentsPeriod">Installments Period</label>
                                 <div class="input-group">
                                    <select class="form-control" id="confirmInstallmentsPeriod">
                                       <option value="days">DAYS</option>
                                       <option value="weeks">WEEKS</option>
                                       <option value="months">MONTHS</option>
                                       <option value="quarters">QUARTERS</option>
                                       <option value="years">YEARS</option>
                                    </select>
                                 </div>
                              </div>

                              <div class="form-group col-12 col-lg-2">
                                 <label>&nbsp;</label>
                                 <input class="form-control btn-primary" type="button" value="Save" id="save" />
                                 <div id="loaderDiv"> </div>
                              </div>
                           </div>

                        </fieldset>
                     </div>
                  </form>

               </div>
               <!-- /.row (nested) -->
            </div>
            <!-- /.panel-body -->
         </div>
         <!-- /.panel -->
      </div>
      <!-- /.col-lg-12 -->
   </div>
   <!-- /.row -->

</div>
<script src="https://momentjs.com/downloads/moment.js"></script>
<script type="text/javascript">

   $("#save").on("click", function () {
      var body = {
         type: $('#confirmType').val(),
         category: $('#confirmCategory').val(),
         date: moment($('#confirmDate').val()).format('MM/DD/YYYY'),
         amount: $('#confirmAmount').val(),
         method: $('#confirmMethod').val(),
         status: $('#confirmStatus').val(),
         description: $('#confirmDescription').val()
      }

      const numberOfInstallments = $('#confirmNumberOfInstallments').val()
      if (numberOfInstallments >= 2) {
         body.numberOfInstallments = numberOfInstallments
         body.installmentsPeriod = $('#confirmInstallmentsPeriod').val()
      }

      $('#loaderDiv').addClass('loader');
      $("#save").hide();

      $.ajax({
         url: '/api/transactions',
         type: 'POST',
         contentType: 'application/json',
         data: JSON.stringify(body),
         success: function (data) {
            alert("Transação criada com sucesso!");
            $('#loaderDiv').removeClass('loader');
            $("#save").show();
         },
         error: function (err) {
            $('#loaderDiv').removeClass('loader');
            $("#save").show();
            console.log(err)
            if (err && err.responseJSON && err.responseJSON.errors) {
               alert(JSON.stringify(err.responseJSON.errors));
            }
         }
      });
   });
</script>